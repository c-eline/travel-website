<html>
<head>
<title>main.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #8c8c8c; font-style: italic;}
.s1 { color: #080808;}
.s2 { color: #0033b3;}
.s3 { color: #067d17;}
.s4 { color: #1750eb;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
main.py</font>
</center></td></tr></table>
<pre><span class="s0"># Import necessary tools &amp; features</span>

<span class="s2">import </span><span class="s1">sqlite3</span>
<span class="s2">from </span><span class="s1">gettext </span><span class="s2">import </span><span class="s1">install</span>
<span class="s2">from </span><span class="s1">sqlite3 </span><span class="s2">import </span><span class="s1">Error</span>
<span class="s2">from </span><span class="s1">flask </span><span class="s2">import </span><span class="s1">Flask, render_template, request, url_for, flash</span>
<span class="s2">from </span><span class="s1">flask_bcrypt </span><span class="s2">import </span><span class="s1">Bcrypt</span>
<span class="s2">from </span><span class="s1">flask_login </span><span class="s2">import </span><span class="s1">LoginManager, login_user, current_user, logout_user, login_required</span>
<span class="s2">from </span><span class="s1">werkzeug.utils </span><span class="s2">import </span><span class="s1">redirect</span>

<span class="s2">import </span><span class="s1">re</span>

<span class="s2">from </span><span class="s1">flask </span><span class="s2">import </span><span class="s1">Flask, render_template, jsonify</span>


<span class="s0"># DB file name</span>
<span class="s1">db_file = </span><span class="s3">&quot;mySQLite.db&quot;</span>

<span class="s2">def </span><span class="s1">create_connection():</span>
    <span class="s0">&quot;&quot;&quot; create a database connection to a SQLite database &quot;&quot;&quot;</span>
    <span class="s1">conn = </span><span class="s2">None</span>
    <span class="s2">try</span><span class="s1">:</span>
     <span class="s1">conn = sqlite3.connect(db_file)</span>
    <span class="s2">except </span><span class="s1">Error </span><span class="s2">as </span><span class="s1">e:</span>
        <span class="s1">print(e)</span>
    <span class="s2">finally</span><span class="s1">:</span>
        <span class="s2">if </span><span class="s1">conn:</span>
            <span class="s1">conn.close()</span>
    <span class="s2">def </span><span class="s1">create_database():</span>
        <span class="s0">&quot;&quot;&quot; create a database connection to a SQLite database &quot;&quot;&quot;</span>
    <span class="s1">conn = </span><span class="s2">None</span>
    <span class="s2">try</span><span class="s1">:</span>
        <span class="s1">conn = sqlite3.connect(db_file)</span>

    <span class="s0"># cursor object (to allow python to interact w/ DB)</span>
        <span class="s1">cursor = conn.cursor()</span>

        <span class="s0"># Drop the COMMENTSCOLOMBIA table if already exists.</span>
        <span class="s1">cursor.execute(</span><span class="s3">&quot;DROP TABLE IF EXISTS COMMENTSCOLOMBIA&quot;</span><span class="s1">)</span>

        <span class="s0"># Creating the COMMENTSBRAZIL table</span>
        <span class="s1">table = </span><span class="s3">&quot;&quot;&quot;CREATE TABLE COMMENTSCOLOMBIA ( 
                                     CommentId INTEGER PRIMARY KEY AUTOINCREMENT, 
                                     Username VARCHAR(255) NOT NULL, 
                                     Comment TEXT NOT NULL, 
                                     FOREIGN KEY(Username) REFERENCES USER(Username) 
                                 );&quot;&quot;&quot;</span>
        <span class="s1">cursor.execute(table)</span>

        <span class="s0"># Drop the COMMENTSBRAZIL table if already exists.</span>

        <span class="s1">cursor.execute(</span><span class="s3">&quot;DROP TABLE IF EXISTS COMMENTSBRAZIL&quot;</span><span class="s1">)</span>

        <span class="s0"># Creating COMMENTSBRAZIL table</span>

        <span class="s1">table = </span><span class="s3">&quot;&quot;&quot;CREATE TABLE COMMENTSBRAZIL ( 
                                     CommentId INTEGER PRIMARY KEY AUTOINCREMENT, 
                                     Username VARCHAR(255) NOT NULL, 
                                     Comment TEXT NOT NULL, 
                                     FOREIGN KEY(Username) REFERENCES USER(Username) 
                                 );&quot;&quot;&quot;</span>
        <span class="s1">cursor.execute(table)</span>

        <span class="s0"># Drop the COMMENTSGAL table if already exists.</span>

        <span class="s1">cursor.execute(</span><span class="s3">&quot;DROP TABLE IF EXISTS COMMENTSGAL&quot;</span><span class="s1">)</span>

        <span class="s0"># Creating COMMENTSGAL table</span>

        <span class="s1">table = </span><span class="s3">&quot;&quot;&quot;CREATE TABLE COMMENTSGAL ( 
                                             CommentId INTEGER PRIMARY KEY AUTOINCREMENT, 
                                             Username VARCHAR(255) NOT NULL, 
                                             Comment TEXT NOT NULL, 
                                             FOREIGN KEY(Username) REFERENCES USER(Username) 
                                         );&quot;&quot;&quot;</span>
        <span class="s1">cursor.execute(table)</span>

        <span class="s0"># Drop the USER table if already exists.</span>
        <span class="s1">cursor.execute(</span><span class="s3">&quot;DROP TABLE IF EXISTS USER&quot;</span><span class="s1">)</span>
        <span class="s0"># Creating USER table</span>
        <span class="s1">table = </span><span class="s3">&quot;&quot;&quot; CREATE TABLE USER ( 
                                             Username VARCHAR(255) PRIMARY KEY, 
                                             Password VARCHAR(255) NOT NULL, 
                                             Email VARCHAR(255) NOT NULL, 
                                             First_Name CHAR(25), 
                                             Last_Name CHAR(25), 
                                             Gender CHAR(25), 
                                             Bio TEXT 
                                         ); &quot;&quot;&quot;</span>
        <span class="s1">cursor.execute(table)</span>

        <span class="s0"># Create KNOWN_LANGUAGES table</span>
        <span class="s1">cursor.execute(</span><span class="s3">&quot;DROP TABLE IF EXISTS KNOWN_LANGUAGES&quot;</span><span class="s1">)</span>
        <span class="s1">table = </span><span class="s3">&quot;&quot;&quot; CREATE TABLE KNOWN_LANGUAGES ( 
                                                     Id INTEGER PRIMARY KEY AUTOINCREMENT, 
                                                     LanguageName VARCHAR(255), 
                                                     Username INTEGER, 
                                                     FOREIGN KEY(Username) REFERENCES USER(Username) 
                                                 ); &quot;&quot;&quot;</span>
        <span class="s1">cursor.execute(table)</span>

        <span class="s0"># Create FEEDBACK TABLE</span>
        <span class="s1">cursor.execute(</span><span class="s3">&quot;DROP TABLE IF EXISTS FEEDBACK&quot;</span><span class="s1">)</span>
        <span class="s1">table = </span><span class="s3">&quot;&quot;&quot; CREATE TABLE FEEDBACK ( 
                                      Name VARCHAR(255), 
                                      Email VARCHAR(255) NOT NULL, 
                                      Feedback TEXT 
                                  ); &quot;&quot;&quot;</span>
        <span class="s1">cursor.execute(table)</span>

        <span class="s0"># Create stories TABLE</span>
        <span class="s1">cursor.execute(</span><span class="s3">&quot;DROP TABLE IF EXISTS STORIES&quot;</span><span class="s1">)</span>
        <span class="s1">table = </span><span class="s3">&quot;&quot;&quot; CREATE TABLE STORIES ( 
                                        Name VARCHAR(255), 
                                        Email VARCHAR(255) NOT NULL, 
                                        Story TEXT 
                                    ); &quot;&quot;&quot;</span>
        <span class="s1">cursor.execute(table)</span>




        <span class="s1">conn.commit()</span>
        <span class="s1">print(</span><span class="s3">&quot;Tables created successfully.&quot;</span><span class="s1">)       </span><span class="s0">#print when tables are created</span>

    <span class="s2">except </span><span class="s1">Error </span><span class="s2">as </span><span class="s1">e:</span>
        <span class="s1">print(e)</span>
    <span class="s2">finally</span><span class="s1">:</span>
        <span class="s2">if </span><span class="s1">conn:</span>
            <span class="s1">conn.close()</span>


<span class="s0"># Initialise flask app, set environment to dev, enable debug, set to &quot;production&quot; and false when website is launched</span>
<span class="s1">app = Flask(__name__)</span>
<span class="s1">app.config[</span><span class="s3">'ENV'</span><span class="s1">] = </span><span class="s3">&quot;Development&quot;</span>
<span class="s1">app.config[</span><span class="s3">'DEBUG'</span><span class="s1">] = </span><span class="s2">True</span>

<span class="s0"># Create bcyrpt object</span>
<span class="s1">bcrypt = Bcrypt(app)</span>

<span class="s0"># Create a LoginManager object</span>

<span class="s1">login_manager = LoginManager()</span>
<span class="s1">login_manager.init_app(app)</span>
<span class="s1">login_manager.login_view = </span><span class="s3">'loginAction'</span>

<span class="s0"># User Class for the user that will be stored when the user is logged in</span>
<span class="s2">class </span><span class="s1">User():</span>
    <span class="s2">def </span><span class="s1">__init__(self, username):</span>
         <span class="s1">self.username = username</span>
    <span class="s2">def </span><span class="s1">is_authenticated(self):</span>
         <span class="s2">return True</span>
    <span class="s2">def </span><span class="s1">is_active(self):</span>
         <span class="s2">return True</span>
    <span class="s2">def </span><span class="s1">is_anonymous(self):</span>
         <span class="s2">return False</span>
    <span class="s2">def </span><span class="s1">get_id(self):</span>
         <span class="s2">return </span><span class="s1">self.username</span>

<span class="s0"># route to html home page 'index'</span>
<span class="s1">@app.route(</span><span class="s3">'/'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">home():</span>
    <span class="s2">return </span><span class="s1">render_template(</span><span class="s3">'index.html'</span><span class="s1">)</span>

<span class="s0"># Load user function</span>
<span class="s1">@login_manager.user_loader</span>
<span class="s2">def </span><span class="s1">load_user(username):</span>
    <span class="s2">return </span><span class="s1">User(username)</span>

<span class="s0"># Set a secret key for the login session</span>
<span class="s0"># a “secret key” also needed for the application to sign the cookies in a way similar to how a &quot;salt&quot; would be used to muddle a password before hashing</span>
<span class="s0"># to avoid attackers tempering the content of our cookies/creating illegitimate cookies</span>
<span class="s1">app.secret_key = </span><span class="s3">'*£^*sjeycvrkAnJ^'</span>


<span class="s0"># route to signup page</span>
<span class="s1">@app.route(</span><span class="s3">'/signup'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">signup():</span>
    <span class="s2">return </span><span class="s1">render_template(</span><span class="s3">&quot;signup.html&quot;</span><span class="s1">)</span>

<span class="s0"># Route to get in touch page</span>
<span class="s1">@app.route(</span><span class="s3">'/getintouch'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">getintouch():</span>
    <span class="s2">return </span><span class="s1">render_template(</span><span class="s3">&quot;getintouch.html&quot;</span><span class="s1">)</span>

<span class="s0"># Route to tips page</span>
<span class="s1">@app.route(</span><span class="s3">'/traveltips'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">traveltips():</span>
    <span class="s2">return </span><span class="s1">render_template(</span><span class="s3">&quot;traveltips.html&quot;</span><span class="s1">)</span>

<span class="s0"># Route to contact us page</span>
<span class="s1">@app.route(</span><span class="s3">'/contactus'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">countrymap():</span>
    <span class="s2">return </span><span class="s1">render_template(</span><span class="s3">&quot;contactus.html&quot;</span><span class="s1">)</span>

<span class="s0"># Route to popular destinations page</span>
<span class="s1">@app.route(</span><span class="s3">'/popdestinations'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">popdestinations():</span>
    <span class="s2">return </span><span class="s1">render_template(</span><span class="s3">&quot;popdestinations.html&quot;</span><span class="s1">)</span>

<span class="s0"># Route to travel stories page</span>
<span class="s1">@app.route(</span><span class="s3">'/travelstories'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">travelstories():</span>
    <span class="s2">return </span><span class="s1">render_template(</span><span class="s3">&quot;travelstories.html&quot;</span><span class="s1">)</span>

<span class="s0"># Route to facts page</span>
<span class="s1">@app.route(</span><span class="s3">'/facts'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">facts():</span>
    <span class="s2">return </span><span class="s1">render_template(</span><span class="s3">&quot;facts.html&quot;</span><span class="s1">)</span>

<span class="s0"># Route to brazil travel page</span>
<span class="s1">@app.route(</span><span class="s3">'/brazil'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">brazil():</span>
    <span class="s2">return </span><span class="s1">render_template(</span><span class="s3">&quot;brazil.html&quot;</span><span class="s1">)</span>

<span class="s0"># Route to colombia travel page</span>
<span class="s1">@app.route(</span><span class="s3">'/colombia'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">colombia():</span>
    <span class="s2">return </span><span class="s1">render_template(</span><span class="s3">&quot;colombia.html&quot;</span><span class="s1">)</span>

<span class="s0"># Route to feedback page</span>
<span class="s1">@app.route(</span><span class="s3">'/feedbackform'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">feedbackform():</span>
    <span class="s2">return </span><span class="s1">render_template(</span><span class="s3">&quot;feedbackform.html&quot;</span><span class="s1">)</span>

<span class="s0"># Route to galapagos travel page</span>
<span class="s1">@app.route(</span><span class="s3">'/galapagos'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">galapagos():</span>
    <span class="s2">return </span><span class="s1">render_template(</span><span class="s3">&quot;galapagos.html&quot;</span><span class="s1">)</span>


<span class="s1">@app.route(</span><span class="s3">'/signupAction'</span><span class="s1">, methods=[</span><span class="s3">'POST'</span><span class="s1">])</span>
<span class="s2">def </span><span class="s1">signupAction():</span>
    <span class="s0"># Variables initialised to empty so they will be ready to store user input received from the form</span>
    <span class="s1">username = </span><span class="s3">&quot;&quot;</span>
    <span class="s1">password = </span><span class="s3">&quot;&quot;</span>
    <span class="s1">email = </span><span class="s3">&quot;&quot;</span>
    <span class="s1">fname = </span><span class="s3">&quot;&quot;</span>
    <span class="s1">lname = </span><span class="s3">&quot;&quot;</span>
    <span class="s1">gender = </span><span class="s3">&quot;&quot;</span>
    <span class="s1">list_known_languages = []</span>
    <span class="s1">bio = </span><span class="s3">&quot;&quot;</span>
    <span class="s0"># Retrieving form data, checking if fields are present in form submitted by user</span>
    <span class="s2">if </span><span class="s1">request.form.get(</span><span class="s3">&quot;username&quot;</span><span class="s1">):</span>
        <span class="s1">username = request.form.get(</span><span class="s3">&quot;username&quot;</span><span class="s1">)</span>
    <span class="s2">if </span><span class="s1">request.form.get(</span><span class="s3">&quot;password&quot;</span><span class="s1">):</span>
        <span class="s1">password = request.form.get(</span><span class="s3">&quot;password&quot;</span><span class="s1">)</span>

        <span class="s0"># Password is a normal string</span>
        <span class="s0"># Check if password meets requirements</span>
        <span class="s2">if </span><span class="s1">len(password) &lt; </span><span class="s4">10 </span><span class="s2">or </span><span class="s1">len(password) &gt; </span><span class="s4">64</span><span class="s1">:</span>
            <span class="s1">flash(</span><span class="s3">&quot;Password must be between 10 and 64 characters long.&quot;</span><span class="s1">)</span>
            <span class="s2">return </span><span class="s1">redirect(url_for(</span><span class="s3">'signup'</span><span class="s1">))</span>

        <span class="s2">if not </span><span class="s1">re.search(</span><span class="s3">r&quot;[A-Z]&quot;</span><span class="s1">, password) </span><span class="s2">or not </span><span class="s1">re.search(</span><span class="s3">r&quot;[a-z]&quot;</span><span class="s1">, password) </span><span class="s2">or not </span><span class="s1">re.search(</span>
                <span class="s3">r&quot;[!@#$%^&amp;*()\-_=+{};:,&lt;.&gt;]&quot;</span><span class="s1">, password):</span>
            <span class="s1">flash(</span>
                <span class="s3">&quot;Password must contain at least one uppercase letter, one lowercase letter, and one special character.&quot;</span><span class="s1">)</span>
            <span class="s2">return </span><span class="s1">redirect(url_for(</span><span class="s3">'signup'</span><span class="s1">))</span>

        <span class="s0"># Password is a normal string</span>
        <span class="s0"># Hash Password before putting it in the database (using the bcrypt object to hash)</span>
        <span class="s1">hashed_password = bcrypt.generate_password_hash(password).decode(</span><span class="s3">'utf-8'</span><span class="s1">)</span>
        <span class="s1">print(</span><span class="s3">&quot;True Password:&quot;</span><span class="s1">, password, </span><span class="s3">&quot;, Hashed Password:&quot;</span><span class="s1">, hashed_password)</span>
        <span class="s1">password = hashed_password</span>

    <span class="s0"># Retrieving form data, checking if fields are present in form submitted by user</span>
    <span class="s2">if </span><span class="s1">request.form.get(</span><span class="s3">&quot;email&quot;</span><span class="s1">):</span>
        <span class="s1">email = request.form.get(</span><span class="s3">&quot;email&quot;</span><span class="s1">)</span>
    <span class="s2">if </span><span class="s1">request.form.get(</span><span class="s3">&quot;fname&quot;</span><span class="s1">):</span>
        <span class="s1">fname = request.form.get(</span><span class="s3">&quot;fname&quot;</span><span class="s1">)</span>
    <span class="s2">if </span><span class="s1">request.form.get(</span><span class="s3">&quot;lname&quot;</span><span class="s1">):</span>
        <span class="s1">lname = request.form.get(</span><span class="s3">&quot;lname&quot;</span><span class="s1">)</span>
    <span class="s2">if </span><span class="s1">request.form.get(</span><span class="s3">&quot;gender&quot;</span><span class="s1">):</span>
        <span class="s1">gender = request.form.get(</span><span class="s3">&quot;gender&quot;</span><span class="s1">)</span>
    <span class="s2">if </span><span class="s1">request.form.get(</span><span class="s3">&quot;bio&quot;</span><span class="s1">):</span>
        <span class="s1">bio = request.form.get(</span><span class="s3">&quot;bio&quot;</span><span class="s1">)</span>
    <span class="s2">if </span><span class="s1">request.form.get(</span><span class="s3">&quot;selected_english&quot;</span><span class="s1">):</span>
        <span class="s1">list_known_languages.append(</span><span class="s3">&quot;English&quot;</span><span class="s1">)</span>
    <span class="s2">if </span><span class="s1">request.form.get(</span><span class="s3">&quot;selected_gaeilge&quot;</span><span class="s1">):</span>
        <span class="s1">list_known_languages.append(</span><span class="s3">&quot;Gaeilge&quot;</span><span class="s1">)</span>
    <span class="s2">if </span><span class="s1">request.form.get(</span><span class="s3">&quot;selected_french&quot;</span><span class="s1">):</span>
        <span class="s1">list_known_languages.append(</span><span class="s3">&quot;French&quot;</span><span class="s1">)</span>
    <span class="s2">if </span><span class="s1">request.form.get(</span><span class="s3">&quot;selected_spanish&quot;</span><span class="s1">):</span>
        <span class="s1">list_known_languages.append(</span><span class="s3">&quot;Spanish&quot;</span><span class="s1">)</span>
    <span class="s2">if </span><span class="s1">request.form.get(</span><span class="s3">&quot;selected_italian&quot;</span><span class="s1">):</span>
        <span class="s1">list_known_languages.append(</span><span class="s3">&quot;Italian&quot;</span><span class="s1">)</span>

    <span class="s2">try</span><span class="s1">:</span>
        <span class="s1">conn = sqlite3.connect(db_file)</span>
        <span class="s1">cursor = conn.cursor()</span>
        <span class="s1">myquery = </span><span class="s3">&quot;INSERT INTO USER (Username,Password,Email,First_Name,Last_Name,Gender,Bio) VALUES (?,?,?,?,?,?,?)&quot;   </span><span class="s0">#parameterised values to prevent SQL injection</span>
        <span class="s1">print(</span><span class="s3">&quot;My query is: &quot;</span><span class="s1">, myquery)</span>
        <span class="s1">cursor.execute(myquery, (username, password, email, fname, lname, gender, bio))</span>

        <span class="s2">for </span><span class="s1">languageName </span><span class="s2">in </span><span class="s1">list_known_languages:</span>
            <span class="s1">myquery = </span><span class="s3">&quot;INSERT INTO KNOWN_LANGUAGES (LanguageName,Username) VALUES (?,?)&quot;    </span><span class="s0">#parameterised values to prevent SQL injection</span>
            <span class="s1">print(</span><span class="s3">&quot;My query is: &quot;</span><span class="s1">, myquery)</span>
            <span class="s1">cursor.execute(myquery,(languageName, username))</span>
        <span class="s1">conn.commit()</span>
      <span class="s0">## if this works, this means the user have been added succesfully</span>
        <span class="s0">## Therefore, we need to send them to the login page</span>
    <span class="s2">except </span><span class="s1">Error </span><span class="s2">as </span><span class="s1">e:</span>
        <span class="s0">## if the user is not added, we will get an exception which will be caught here</span>
        <span class="s0">#sign up was unsuccessful, tells user to try again</span>
        <span class="s1">flash(</span><span class="s3">&quot;Failed to signup. Try again!&quot;</span><span class="s1">)</span>
        <span class="s2">return </span><span class="s1">redirect(url_for(</span><span class="s3">'signup'</span><span class="s1">))</span>
    <span class="s2">finally</span><span class="s1">:</span>
        <span class="s2">if </span><span class="s1">conn:</span>
            <span class="s1">conn.close()   </span><span class="s0">#close DB connection</span>
    <span class="s0">#account created, redirected to login page</span>
    <span class="s1">flash(</span><span class="s3">&quot;Account created successfully.&quot;</span><span class="s1">)</span>
    <span class="s2">return </span><span class="s1">redirect(url_for(</span><span class="s3">'login'</span><span class="s1">))</span>

<span class="s1">@app.route(</span><span class="s3">'/login'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">login():</span>

    <span class="s0">## If user is already logged in we need to redirect them to their profile</span>
    <span class="s2">if </span><span class="s1">current_user.is_authenticated:</span>
        <span class="s1">flash(</span><span class="s3">&quot;You are already logged in.&quot;</span><span class="s1">)</span>
        <span class="s2">return </span><span class="s1">redirect(url_for(</span><span class="s3">'profile'</span><span class="s1">))</span>
    <span class="s2">return </span><span class="s1">render_template(</span><span class="s3">&quot;login.html&quot;</span><span class="s1">)</span>

<span class="s1">@app.route(</span><span class="s3">'/loginAction'</span><span class="s1">, methods=[</span><span class="s3">'POST'</span><span class="s1">])</span>
<span class="s2">def </span><span class="s1">loginAction():</span>
    <span class="s0"># Variables initialised to empty so they will be ready to store user input received from the form</span>
    <span class="s1">username=</span><span class="s3">&quot;&quot;</span>
    <span class="s1">password=</span><span class="s3">&quot;&quot;</span>
    <span class="s0"># Retrieving form data, checking if fields are present in form submitted by user</span>
    <span class="s2">if </span><span class="s1">request.form.get(</span><span class="s3">&quot;username&quot;</span><span class="s1">):</span>
        <span class="s1">username=request.form.get(</span><span class="s3">&quot;username&quot;</span><span class="s1">)</span>
    <span class="s2">if </span><span class="s1">request.form.get(</span><span class="s3">&quot;password&quot;</span><span class="s1">):</span>
        <span class="s1">password = request.form.get(</span><span class="s3">&quot;password&quot;</span><span class="s1">)</span>
    <span class="s2">try</span><span class="s1">:</span>
        <span class="s1">conn = sqlite3.connect(db_file)     </span><span class="s0">#connect to DB</span>
        <span class="s1">cursor = conn.cursor()              </span><span class="s0">#create cursor(so python code can interact with DB)</span>
        <span class="s1">myquery=</span><span class="s3">&quot;SELECT Password FROM USER WHERE Username='&quot;</span><span class="s1">+username+</span><span class="s3">&quot;'&quot;       </span><span class="s0">#SQL query to select password</span>
        <span class="s1">data=cursor.execute(myquery)</span>
        <span class="s1">passwordInDB=</span><span class="s2">None</span>
        <span class="s2">for </span><span class="s1">row </span><span class="s2">in </span><span class="s1">data:</span>
            <span class="s1">passwordInDB=row[</span><span class="s4">0</span><span class="s1">]</span>
        <span class="s2">if </span><span class="s1">passwordInDB:</span>

            <span class="s0">## We have found a username matching the one provide for the login</span>
            <span class="s0">## Now, we need to check that the password provide for the login is also correct</span>
            <span class="s1">validPassword = bcrypt.check_password_hash(passwordInDB, password)</span>


            <span class="s0">## If the passwords match, we need to mark them as logged in and send them to their profile</span>
            <span class="s0">## Else we need to send them to the login page again</span>
            <span class="s2">if </span><span class="s1">validPassword:</span>
                <span class="s1">login_user(User(username))</span>
                <span class="s1">flash(</span><span class="s3">&quot;You are now logged in.&quot;</span><span class="s1">)</span>
                <span class="s2">return </span><span class="s1">redirect(url_for(</span><span class="s3">'profile'</span><span class="s1">))</span>
            <span class="s2">else</span><span class="s1">:</span>

                <span class="s0">## The Username does not exist</span>
                <span class="s0">## we need to send them to the login page again</span>
                <span class="s1">flash(</span><span class="s3">&quot;Your username/password is incorrect! Try to login again.&quot;</span><span class="s1">)</span>
                <span class="s2">return </span><span class="s1">redirect(url_for(</span><span class="s3">'login'</span><span class="s1">))</span>
    <span class="s2">except </span><span class="s1">Error </span><span class="s2">as </span><span class="s1">e:</span>
        <span class="s0">## if there was an error in the login, we will get an exception which will be caught here</span>
        <span class="s0">## So we need to send the user to the login page again</span>
        <span class="s1">flash(</span><span class="s3">&quot;Failed to login. Try again!&quot;</span><span class="s1">)</span>
        <span class="s2">return </span><span class="s1">redirect(url_for(</span><span class="s3">'login'</span><span class="s1">))</span>
    <span class="s2">finally</span><span class="s1">:</span>
        <span class="s2">if </span><span class="s1">conn:</span>
            <span class="s1">conn.close()</span>
    <span class="s1">flash(</span><span class="s3">&quot;You are now logged in.&quot;</span><span class="s1">)</span>
    <span class="s2">return </span><span class="s1">redirect(url_for(</span><span class="s3">'profile'</span><span class="s1">))</span>


<span class="s1">@app.route(</span><span class="s3">'/profile'</span><span class="s1">, methods=[</span><span class="s3">'GET'</span><span class="s1">])</span>
<span class="s2">def </span><span class="s1">profile():</span>

    <span class="s0">## If the user is not logged in, we need to redirect them to the login page</span>
    <span class="s2">if not </span><span class="s1">(current_user.is_authenticated):</span>
        <span class="s1">flash(</span><span class="s3">&quot;You need to login to access the profile page.&quot;</span><span class="s1">)</span>
        <span class="s2">return </span><span class="s1">redirect(url_for(</span><span class="s3">'login'</span><span class="s1">))</span>


    <span class="s0">## If the user is logged in, we need to get their username</span>
    <span class="s1">myusername = current_user.username</span>


    <span class="s1">conn = </span><span class="s2">None</span>
    <span class="s2">try</span><span class="s1">:</span>
        <span class="s1">conn = sqlite3.connect(db_file)</span>
        <span class="s1">cursor = conn.cursor()</span>
        <span class="s1">myemail=</span><span class="s3">&quot;&quot;</span>
        <span class="s1">myfname=</span><span class="s3">&quot;&quot;</span>
        <span class="s1">mylname=</span><span class="s3">&quot;&quot;</span>
        <span class="s1">mygender=</span><span class="s3">&quot;&quot;</span>
        <span class="s1">mybio=</span><span class="s3">&quot;&quot;</span>
        <span class="s1">myknown_languages=[]</span>
        <span class="s0"># Get the personal data of the user</span>
        <span class="s1">myquery=</span><span class="s3">&quot;SELECT Email, First_Name, Last_Name, Gender, Bio FROM USER WHERE Username='&quot;</span><span class="s1">+myusername+</span><span class="s3">&quot;'&quot;</span>
        <span class="s1">dataUser = cursor.execute(myquery)</span>
        <span class="s1">print(</span><span class="s3">&quot;These are the details of the user: &quot;</span><span class="s1">)</span>
        <span class="s1">rows=[]</span>
        <span class="s2">for </span><span class="s1">row </span><span class="s2">in </span><span class="s1">dataUser:</span>
            <span class="s1">print(row)</span>
            <span class="s1">rows.append(row)</span>
        <span class="s2">if </span><span class="s1">len(rows)==</span><span class="s4">1</span><span class="s1">:</span>
            <span class="s1">myemail=rows[</span><span class="s4">0</span><span class="s1">][</span><span class="s4">0</span><span class="s1">]</span>
            <span class="s1">myfname=rows[</span><span class="s4">0</span><span class="s1">][</span><span class="s4">1</span><span class="s1">]</span>
            <span class="s1">mylname=rows[</span><span class="s4">0</span><span class="s1">][</span><span class="s4">2</span><span class="s1">]</span>
            <span class="s1">mygender=rows[</span><span class="s4">0</span><span class="s1">][</span><span class="s4">3</span><span class="s1">]</span>
            <span class="s1">mybio=rows[</span><span class="s4">0</span><span class="s1">][</span><span class="s4">4</span><span class="s1">]</span>
        <span class="s2">else</span><span class="s1">:</span>
            <span class="s2">return </span><span class="s3">&quot;Error: the Username does not exist&quot;</span>

        <span class="s0"># Get the know languages of the User</span>
        <span class="s1">myquery = </span><span class="s3">&quot;SELECT LanguageName FROM KNOWN_LANGUAGES WHERE Username='&quot; </span><span class="s1">+ myusername + </span><span class="s3">&quot;'&quot;</span>
        <span class="s1">dataUser = cursor.execute(myquery)</span>
        <span class="s1">print(</span><span class="s3">&quot;These are the user's known languages: &quot;</span><span class="s1">)</span>
        <span class="s2">for </span><span class="s1">row </span><span class="s2">in </span><span class="s1">dataUser:</span>
            <span class="s1">print(row)</span>
            <span class="s1">myknown_languages.append(row[</span><span class="s4">0</span><span class="s1">])</span>
    <span class="s2">except </span><span class="s1">Error </span><span class="s2">as </span><span class="s1">e:</span>
        <span class="s1">print(e)</span>
    <span class="s2">finally</span><span class="s1">:</span>
        <span class="s2">if </span><span class="s1">conn:</span>
            <span class="s1">conn.close()    </span><span class="s0">#close connection to database</span>

    <span class="s0"># the data of the user is included in this render, so it is retrieved from the database</span>
    <span class="s2">return </span><span class="s1">render_template(</span><span class="s3">&quot;profile.html&quot;</span><span class="s1">, username=myusername,email=myemail,fname=myfname,lname=mylname, gender=mygender,known_languages=myknown_languages,bio=mybio)</span>

<span class="s0">#function to logout user</span>
<span class="s1">@app.route(</span><span class="s3">&quot;/logout&quot;</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">logout():</span>

    <span class="s0">## If the user is logged in, then logout the user</span>
    <span class="s2">if </span><span class="s1">current_user.is_authenticated:</span>
        <span class="s1">logout_user()</span>
    <span class="s1">flash(</span><span class="s3">&quot;Logout successful.&quot;</span><span class="s1">)</span>
    <span class="s2">return </span><span class="s1">redirect(url_for(</span><span class="s3">'login'</span><span class="s1">))</span>

<span class="s0">#to insert user input to feedback table, create connection &amp; execute SQL query</span>
<span class="s1">@app.route(</span><span class="s3">'/feedback'</span><span class="s1">, methods=[</span><span class="s3">'POST'</span><span class="s1">])</span>
<span class="s2">def </span><span class="s1">submit_feedback():</span>
    <span class="s2">if </span><span class="s1">request.method == </span><span class="s3">'POST'</span><span class="s1">:</span>
        <span class="s1">name = request.form[</span><span class="s3">'name'</span><span class="s1">]</span>
        <span class="s1">email = request.form[</span><span class="s3">'email'</span><span class="s1">]</span>
        <span class="s1">feedback = request.form[</span><span class="s3">'feedback'</span><span class="s1">]</span>

        <span class="s0"># Connect to SQLite database</span>
        <span class="s1">conn = sqlite3.connect(</span><span class="s3">'mySQLite.db'</span><span class="s1">)</span>
        <span class="s1">cursor = conn.cursor()</span>

        <span class="s0"># Insert data into feedback table</span>
        <span class="s1">cursor.execute(</span><span class="s3">&quot;INSERT INTO feedback (name, email, feedback) VALUES (?, ?, ?)&quot;</span><span class="s1">, (name, email, feedback))    </span><span class="s0">#parameterised values to prevent SQL injection</span>
        <span class="s1">conn.commit()</span>

        <span class="s1">cursor.close()</span>
        <span class="s1">conn.close()</span>

        <span class="s1">flash(</span><span class="s3">'Feedback submitted successfully!'</span><span class="s1">, </span><span class="s3">'success'</span><span class="s1">)  </span><span class="s0"># Flash success message</span>
    <span class="s2">else</span><span class="s1">:</span>
        <span class="s1">flash(</span><span class="s3">'Feedback submission failed.'</span><span class="s1">, </span><span class="s3">'error'</span><span class="s1">)  </span><span class="s0"># Flash error message</span>

    <span class="s2">return </span><span class="s1">redirect(url_for(</span><span class="s3">'feedbackform'</span><span class="s1">))        </span><span class="s0">#return to feedback page</span>


<span class="s0">#to insert user input to stories table, create connection &amp; execute SQL query</span>
<span class="s1">@app.route(</span><span class="s3">'/story'</span><span class="s1">, methods=[</span><span class="s3">'POST'</span><span class="s1">])</span>
<span class="s2">def </span><span class="s1">submit_story():</span>
    <span class="s2">if </span><span class="s1">request.method == </span><span class="s3">'POST'</span><span class="s1">:</span>
        <span class="s1">name = request.form[</span><span class="s3">'name'</span><span class="s1">]</span>
        <span class="s1">email = request.form[</span><span class="s3">'email'</span><span class="s1">]</span>
        <span class="s1">story = request.form[</span><span class="s3">'story'</span><span class="s1">]</span>

        <span class="s0"># Connect to SQLite database</span>
        <span class="s1">conn = sqlite3.connect(</span><span class="s3">'mySQLite.db'</span><span class="s1">)</span>
        <span class="s1">cursor = conn.cursor()</span>

        <span class="s0"># Insert data into story table</span>
        <span class="s1">cursor.execute(</span><span class="s3">&quot;INSERT INTO stories (name, email, story) VALUES (?, ?, ?)&quot;</span><span class="s1">, (name, email, story))   </span><span class="s0">#parameterised values to prevent SQL injection</span>
        <span class="s1">conn.commit()</span>

        <span class="s1">cursor.close()</span>
        <span class="s1">conn.close()    </span><span class="s0">#close connection after finishing using the database</span>

        <span class="s1">flash(</span><span class="s3">'Story submitted successfully!'</span><span class="s1">, </span><span class="s3">'success'</span><span class="s1">)  </span><span class="s0"># Flash success message</span>
    <span class="s2">else</span><span class="s1">:</span>
        <span class="s1">flash(</span><span class="s3">'Story submission failed.'</span><span class="s1">, </span><span class="s3">'error'</span><span class="s1">)  </span><span class="s0"># Flash error message</span>

    <span class="s2">return </span><span class="s1">redirect(url_for(</span><span class="s3">'travelstories'</span><span class="s1">))       </span><span class="s0">#return to story entry page</span>

<span class="s0">#check user is authenticated before they attempt to leave a comment (only users can leave comments)</span>
<span class="s1">@app.route(</span><span class="s3">'/submit_comment_colombia'</span><span class="s1">, methods=[</span><span class="s3">'POST'</span><span class="s1">])</span>
<span class="s2">def </span><span class="s1">submit_comment_colombia():</span>
    <span class="s2">if </span><span class="s1">current_user.is_authenticated:</span>
        <span class="s1">username = current_user.username</span>
        <span class="s1">comment = request.form.get(</span><span class="s3">'comment'</span><span class="s1">)</span>

        <span class="s0"># to insert values to commentscolombia table, create connection &amp; execute SQL query</span>
        <span class="s2">try</span><span class="s1">:</span>
            <span class="s1">conn = sqlite3.connect(db_file)</span>
            <span class="s1">cursor = conn.cursor()</span>
            <span class="s1">cursor.execute(</span><span class="s3">&quot;INSERT INTO COMMENTSCOLOMBIA (Username, Comment) VALUES (?, ?)&quot;</span><span class="s1">, (username, comment))   </span><span class="s0">#parameterised values to prevent SQL injection</span>
            <span class="s1">conn.commit()</span>
            <span class="s1">flash(</span><span class="s3">'Comment submitted successfully!'</span><span class="s1">, </span><span class="s3">'success'</span><span class="s1">)  </span><span class="s0"># Flash success message</span>
        <span class="s2">except </span><span class="s1">Error </span><span class="s2">as </span><span class="s1">e:</span>
            <span class="s1">print(e)</span>
            <span class="s1">flash(</span><span class="s3">'An error occurred while submitting the comment.'</span><span class="s1">, </span><span class="s3">'error'</span><span class="s1">)  </span><span class="s0"># Flash error message</span>
        <span class="s2">finally</span><span class="s1">:</span>
            <span class="s2">if </span><span class="s1">conn:</span>
                <span class="s1">conn.close()</span>

        <span class="s0"># Redirect back to the page from where the request was made</span>
        <span class="s2">return </span><span class="s1">redirect(request.referrer)</span>
    <span class="s2">else</span><span class="s1">:</span>
        <span class="s1">flash(</span><span class="s3">'You need to login to submit a comment.'</span><span class="s1">, </span><span class="s3">'error'</span><span class="s1">)  </span><span class="s0"># Flash error message</span>
        <span class="s2">return </span><span class="s1">redirect(url_for(</span><span class="s3">'login'</span><span class="s1">))  </span><span class="s0"># Redirect to login page</span>


<span class="s2">def </span><span class="s1">get_comments_colombia():</span>
    <span class="s2">try</span><span class="s1">:</span>
        <span class="s1">conn = sqlite3.connect(db_file)     </span><span class="s0">#create connection to db</span>
        <span class="s1">cursor = conn.cursor()              </span><span class="s0">#create cursor</span>
        <span class="s1">cursor.execute(</span><span class="s3">&quot;SELECT Username, Comment FROM COMMENTSCOLOMBIA&quot;</span><span class="s1">)    </span><span class="s0">#use cursor to select usernames &amp; comments from the colombia comments table</span>
        <span class="s1">comments = cursor.fetchall()</span>
    <span class="s2">except </span><span class="s1">Error </span><span class="s2">as </span><span class="s1">e:</span>
        <span class="s1">print(e)            </span><span class="s0">#print errors</span>
        <span class="s1">comments = []       </span><span class="s0">#if errors found, set comments to empty</span>
    <span class="s2">finally</span><span class="s1">:</span>
        <span class="s2">if </span><span class="s1">conn:</span>
            <span class="s1">conn.close()    </span><span class="s0">#close connection</span>
    <span class="s2">return </span><span class="s1">comments         </span><span class="s0">#return comments</span>

<span class="s1">@app.route(</span><span class="s3">'/get_colombia_comments'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">get_colombia_comments():</span>
    <span class="s1">comments = get_comments_colombia()  </span><span class="s0"># comments variable = comments returned from get_comments_colombia function</span>
    <span class="s2">return </span><span class="s1">jsonify(comments)  </span><span class="s0"># Convert comments to JSON to post to page (for readability)</span>




<span class="s0">#check user is authenticated before they attempt to leave a comment (only users can leave comments)</span>
<span class="s1">@app.route(</span><span class="s3">'/submit_comment_brazil'</span><span class="s1">, methods=[</span><span class="s3">'POST'</span><span class="s1">])</span>
<span class="s2">def </span><span class="s1">submit_comment_brazil():</span>
    <span class="s2">if </span><span class="s1">current_user.is_authenticated:   </span><span class="s0">#if user is authenticated</span>
        <span class="s1">username = current_user.username        </span><span class="s0">#username &amp; comment user submits are both stored in the brazil comments database</span>
        <span class="s1">comment = request.form.get(</span><span class="s3">'comment'</span><span class="s1">)</span>

        <span class="s0">#to insert values(comments) to commentsbrazil table, create connection &amp; execute SQL query</span>
        <span class="s2">try</span><span class="s1">:</span>
            <span class="s1">conn = sqlite3.connect(db_file)     </span><span class="s0">#create connection to DB</span>
            <span class="s1">cursor = conn.cursor()              </span><span class="s0">#create cursor (to allow python code to interact w/ DB)</span>
            <span class="s1">cursor.execute(</span><span class="s3">&quot;INSERT INTO COMMENTSBRAZIL (Username, Comment) VALUES (?, ?)&quot;</span><span class="s1">, (username, comment)) </span><span class="s0">#parameterised values to prevent SQL injection</span>
            <span class="s1">conn.commit()</span>
            <span class="s1">flash(</span><span class="s3">'Comment submitted successfully!'</span><span class="s1">, </span><span class="s3">'success'</span><span class="s1">)  </span><span class="s0"># Flash success message if comment is submitted</span>
        <span class="s2">except </span><span class="s1">Error </span><span class="s2">as </span><span class="s1">e:</span>
            <span class="s1">print(e)            </span><span class="s0">#print errors</span>
            <span class="s1">flash(</span><span class="s3">'An error occurred while submitting the comment.'</span><span class="s1">, </span><span class="s3">'error'</span><span class="s1">)  </span><span class="s0"># Flash error message if failed</span>
        <span class="s2">finally</span><span class="s1">:</span>
            <span class="s2">if </span><span class="s1">conn:</span>
                <span class="s1">conn.close()       </span><span class="s0">#close connection to DB</span>

        <span class="s0"># Redirect back to the page from where the request was made</span>
        <span class="s2">return </span><span class="s1">redirect(request.referrer)</span>
    <span class="s2">else</span><span class="s1">:</span>
        <span class="s1">flash(</span><span class="s3">'You need to login to submit a comment.'</span><span class="s1">, </span><span class="s3">'error'</span><span class="s1">)  </span><span class="s0"># Flash error message if user is not logged in</span>
        <span class="s2">return </span><span class="s1">redirect(url_for(</span><span class="s3">'login'</span><span class="s1">))  </span><span class="s0"># &amp; redirect to login page</span>

<span class="s0">#@app.route('/fetch_comments_brazil')</span>
<span class="s0">#def fetch_comments_brazil():</span>
<span class="s0">#    comments = get_comments_brazil()</span>
<span class="s0">#    return render_template('brazil.html', comments=comments)</span>

<span class="s2">def </span><span class="s1">get_comments_brazil():</span>
    <span class="s2">try</span><span class="s1">:</span>
        <span class="s1">conn = sqlite3.connect(db_file)     </span><span class="s0">#create connection with DB</span>
        <span class="s1">cursor = conn.cursor()              </span><span class="s0">#create cursor (to allow python code to interact w/ DB)</span>
        <span class="s1">cursor.execute(</span><span class="s3">&quot;SELECT Username, Comment FROM COMMENTSBRAZIL&quot;</span><span class="s1">)</span>
        <span class="s1">comments = cursor.fetchall()    </span><span class="s0">#retrieve all from DB</span>
    <span class="s2">except </span><span class="s1">Error </span><span class="s2">as </span><span class="s1">e:      </span><span class="s0">#error handling</span>
        <span class="s1">print(e)            </span><span class="s0">#print errors</span>
        <span class="s1">comments = []       </span><span class="s0">#if error found, set comments to empty</span>
    <span class="s2">finally</span><span class="s1">:</span>
        <span class="s2">if </span><span class="s1">conn:</span>
            <span class="s1">conn.close()    </span><span class="s0">#close DB connection</span>
    <span class="s2">return </span><span class="s1">comments         </span><span class="s0">#return comments from DB</span>

<span class="s1">@app.route(</span><span class="s3">'/get_brazil_comments'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">get_brazil_comments():</span>
    <span class="s1">comments = get_comments_brazil()  </span><span class="s0"># comments variable = comments returned from get_comments_brazil function</span>
    <span class="s2">return </span><span class="s1">jsonify(comments)  </span><span class="s0"># Convert comments to JSON to post to page (for readability)</span>

<span class="s0">#check user is authenticated before they attempt to leave a comment (only users can leave comments)</span>
<span class="s1">@app.route(</span><span class="s3">'/submit_comment_gal'</span><span class="s1">, methods=[</span><span class="s3">'POST'</span><span class="s1">])</span>
<span class="s2">def </span><span class="s1">submit_comment_gal():</span>
    <span class="s2">if </span><span class="s1">current_user.is_authenticated:   </span><span class="s0">#if user is authenticated</span>
        <span class="s1">username = current_user.username</span>
        <span class="s1">comment = request.form.get(</span><span class="s3">'comment'</span><span class="s1">)</span>

        <span class="s0">#to insert values(comments) to commentsgal table, create connection &amp; execute SQL query</span>
        <span class="s2">try</span><span class="s1">:</span>
            <span class="s1">conn = sqlite3.connect(db_file)</span>
            <span class="s1">cursor = conn.cursor()</span>
            <span class="s1">cursor.execute(</span><span class="s3">&quot;INSERT INTO COMMENTSGAL (Username, Comment) VALUES (?, ?)&quot;</span><span class="s1">, (username, comment))    </span><span class="s0">#parameterised values to prevent SQL injection</span>
            <span class="s1">conn.commit()</span>
            <span class="s1">flash(</span><span class="s3">'Comment submitted successfully!'</span><span class="s1">, </span><span class="s3">'success'</span><span class="s1">)  </span><span class="s0"># Flash success message</span>
        <span class="s2">except </span><span class="s1">Error </span><span class="s2">as </span><span class="s1">e:</span>
            <span class="s1">print(e)</span>
            <span class="s1">flash(</span><span class="s3">'An error occurred while submitting the comment.'</span><span class="s1">, </span><span class="s3">'error'</span><span class="s1">)  </span><span class="s0"># Flash error message</span>
        <span class="s2">finally</span><span class="s1">:</span>
            <span class="s2">if </span><span class="s1">conn:</span>
                <span class="s1">conn.close()    </span><span class="s0">#close DB connection</span>

        <span class="s0"># Redirect back to the page from where the request was made</span>
        <span class="s2">return </span><span class="s1">redirect(request.referrer)</span>
    <span class="s2">else</span><span class="s1">:</span>
        <span class="s1">flash(</span><span class="s3">'You need to login to submit a comment.'</span><span class="s1">, </span><span class="s3">'error'</span><span class="s1">)  </span><span class="s0"># Flash error message</span>
        <span class="s2">return </span><span class="s1">redirect(url_for(</span><span class="s3">'login'</span><span class="s1">))  </span><span class="s0"># Redirect to login page</span>


<span class="s2">def </span><span class="s1">get_comments_gal():</span>
    <span class="s2">try</span><span class="s1">:</span>
        <span class="s1">conn = sqlite3.connect(db_file)     </span><span class="s0">#create DB connection</span>
        <span class="s1">cursor = conn.cursor()              </span><span class="s0">#create cursor (object python code uses to interact with DB)</span>
        <span class="s1">cursor.execute(</span><span class="s3">&quot;SELECT Username, Comment FROM COMMENTSGAL&quot;</span><span class="s1">)     </span><span class="s0">#select from DB (SQL)</span>
        <span class="s1">comments = cursor.fetchall()        </span><span class="s0">#retrieve from DB</span>
    <span class="s2">except </span><span class="s1">Error </span><span class="s2">as </span><span class="s1">e:                  </span><span class="s0">#error handling</span>
        <span class="s1">print(e)                     </span><span class="s0">#print errors</span>
        <span class="s1">comments = []               </span><span class="s0">#set comments to empty if error occurs</span>
    <span class="s2">finally</span><span class="s1">:</span>
        <span class="s2">if </span><span class="s1">conn:</span>
            <span class="s1">conn.close()    </span><span class="s0">#close connection</span>
    <span class="s2">return </span><span class="s1">comments         </span><span class="s0">#return comments from DB</span>

<span class="s1">@app.route(</span><span class="s3">'/get_gal_comments'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">get_gal_comments():</span>
    <span class="s1">comments = get_comments_gal()  </span><span class="s0"># comments= comments returned from get_comments_gal function</span>
    <span class="s2">return </span><span class="s1">jsonify(comments)  </span><span class="s0"># Convert comments to JSON for readability</span>




<span class="s2">if </span><span class="s1">__name__ == </span><span class="s3">'__main__'</span><span class="s1">:</span>

   <span class="s0"># create_connection() # Called to also call create_database() function to create tables in database</span>

    <span class="s1">app.run(debug=</span><span class="s2">True</span><span class="s1">)</span>

</pre>
</body>
</html>